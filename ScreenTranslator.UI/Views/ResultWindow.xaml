<Window x:Class="ScreenTranslator.UI.Views.ResultWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:ScreenTranslator.UI.Converters"
        mc:Ignorable="d"
        Title="Translation" Height="250" Width="400"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        Topmost="True" ResizeMode="CanResizeWithGrip" ShowInTaskbar="False"
        Opacity="{Binding WindowOpacity}">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:ValueEqualityConverter x:Key="ValueEqualityConverter"/>
    </Window.Resources>

    <!-- Context Menu for Settings -->
    <Window.ContextMenu>
        <ContextMenu>
            <!-- Language Pairs Submenu (Primary Action) -->
            <MenuItem Header="Languages">
                <MenuItem Header="Japanese -> Vietnamese" Command="{Binding SetLanguageCommand}" CommandParameter="ja-vi" IsCheckable="True" IsChecked="{Binding IsJaViSelected, Mode=OneWay}" StaysOpenOnClick="True"/>
                <MenuItem Header="English -> Vietnamese" Command="{Binding SetLanguageCommand}" CommandParameter="en-vi" IsCheckable="True" IsChecked="{Binding IsEnViSelected, Mode=OneWay}" StaysOpenOnClick="True"/>
            </MenuItem>
            
            <Separator/>

            <!-- Realtime Toggle (Mode) -->
            <MenuItem Header="Realtime Translation" IsCheckable="True" IsChecked="{Binding IsRealtimeActive, Mode=TwoWay}" StaysOpenOnClick="True"/>
            <MenuItem Header="Open Debug Log" Command="{Binding ShowDebugLogCommand}"/>
            
            <Separator/>
            
            <!-- Visual Settings -->
            <MenuItem Header="Show Source Text" IsCheckable="True" IsChecked="{Binding ShowSourceText, Mode=TwoWay}" StaysOpenOnClick="True"/>
            
            <MenuItem Header="Font Size">
                <MenuItem Header="Small (12)" Command="{Binding SetFontSizeCommand}" CommandParameter="12" IsCheckable="True" IsChecked="{Binding WindowFontSize, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=12, Mode=OneWay}" StaysOpenOnClick="True"/>
                <MenuItem Header="Medium (14)" Command="{Binding SetFontSizeCommand}" CommandParameter="14" IsCheckable="True" IsChecked="{Binding WindowFontSize, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=14, Mode=OneWay}" StaysOpenOnClick="True"/>
                <MenuItem Header="Large (18)" Command="{Binding SetFontSizeCommand}" CommandParameter="18" IsCheckable="True" IsChecked="{Binding WindowFontSize, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=18, Mode=OneWay}" StaysOpenOnClick="True"/>
                <MenuItem Header="Extra Large (24)" Command="{Binding SetFontSizeCommand}" CommandParameter="24" IsCheckable="True" IsChecked="{Binding WindowFontSize, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=24, Mode=OneWay}" StaysOpenOnClick="True"/>
            </MenuItem>

            <MenuItem Header="Window Opacity">
                <MenuItem Header="100%" Command="{Binding SetOpacityCommand}" CommandParameter="1.0" IsCheckable="True" IsChecked="{Binding WindowOpacity, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=1.0, Mode=OneWay}" StaysOpenOnClick="True"/>
                <MenuItem Header="90%" Command="{Binding SetOpacityCommand}" CommandParameter="0.9" IsCheckable="True" IsChecked="{Binding WindowOpacity, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=0.9, Mode=OneWay}" StaysOpenOnClick="True"/>
                <MenuItem Header="75%" Command="{Binding SetOpacityCommand}" CommandParameter="0.75" IsCheckable="True" IsChecked="{Binding WindowOpacity, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=0.75, Mode=OneWay}" StaysOpenOnClick="True"/>
                <MenuItem Header="50%" Command="{Binding SetOpacityCommand}" CommandParameter="0.5" IsCheckable="True" IsChecked="{Binding WindowOpacity, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=0.5, Mode=OneWay}" StaysOpenOnClick="True"/>
            </MenuItem>

            <Separator/>
            <MenuItem Header="Close" Command="{Binding HideResultCommand}" InputGestureText="Esc"/>
        </ContextMenu>
    </Window.ContextMenu>

    <Border Background="#CC1E1E1E" BorderBrush="#55FFFFFF" BorderThickness="1" CornerRadius="12">
        <Grid Margin="15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Header -->
                <RowDefinition Height="*"/>    <!-- Content -->
                <RowDefinition Height="Auto"/> <!-- Footer/ResizeGrip area -->
            </Grid.RowDefinitions>

            <!-- Header with PHYSICAL SEPARATION Check (Close Button restored) -->
            <!-- Column 0: Drag Zone (Title + Spacer) -->
            <!-- Column 1: Control Zone (Buttons) - NO Drag Handler here -->
            <Grid Grid.Row="0" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Zone 1: Draggable Area -->
                <Border Grid.Column="0" Background="Transparent" MouseLeftButtonDown="Header_MouseLeftButtonDown">
                    <Grid>
                        <TextBlock Text="ðŸŒ Translation" Foreground="White" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center" IsHitTestVisible="False"/>
                    </Grid>
                </Border>

                <!-- Zone 2: Buttons. NO OVERLAP with Border above. -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="5,0,0,0">
                    
                    <!-- Realtime Indicator -->
                    <Border Width="8" Height="8" CornerRadius="4" Margin="0,0,10,0" VerticalAlignment="Center"
                            ToolTip="Realtime Translation Active"
                            Visibility="{Binding IsRealtimeActive, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Background" Value="#00FF00"/> <!-- Green for Active -->
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsProcessing}" Value="True">
                                        <Setter Property="Background" Value="#FFFF00"/> <!-- Yellow for Processing -->
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                    </Border>

                    <Button Content="âš™" Click="SettingsButton_Click" ToolTip="Settings"
                            Foreground="White" Background="Transparent" BorderThickness="0"
                            Padding="8,0" FontSize="16" Cursor="Hand" FontWeight="Bold" Margin="0,0,0,0"/>

                    <Button Content="âœ•" Command="{Binding HideResultCommand}" ToolTip="Close"
                            Foreground="White" Background="Transparent" BorderThickness="0"
                            Padding="8,0" FontSize="16" Cursor="Hand" FontWeight="Bold"/>
                </StackPanel>
            </Grid>

            <!-- Translation Content -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Source Text (Optional) -->
                    <TextBox Text="{Binding SourceText, Mode=OneWay}" 
                             Visibility="{Binding ShowSourceText, Converter={StaticResource BooleanToVisibilityConverter}}"
                             Foreground="#AAAAAA" Background="Transparent" BorderThickness="0"
                             TextWrapping="Wrap" IsReadOnly="True" 
                             FontSize="{Binding WindowFontSize}" FontStyle="Italic" Margin="0,0,0,10"
                             SelectionBrush="#3498DB" SelectionOpacity="0.5"/>

                    <!-- Separator if Source is visible -->
                    <Separator Visibility="{Binding ShowSourceText, Converter={StaticResource BooleanToVisibilityConverter}}"
                               Background="#33FFFFFF" Margin="0,0,0,10"/>

                    <!-- Translated Text -->
                    <TextBox Text="{Binding TranslatedText, Mode=OneWay}" 
                             Foreground="White" Background="Transparent" BorderThickness="0"
                             TextWrapping="Wrap" IsReadOnly="True" 
                             FontSize="{Binding WindowFontSize}" FontWeight="Normal"
                             SelectionBrush="#3498DB" SelectionOpacity="0.5"/>
                </StackPanel>
            </ScrollViewer>
            
            <!-- Grip hint -->
            <Path Grid.Row="2" Data="M16,16 L16,0 L0,16 Z" Fill="#44FFFFFF" 
                  HorizontalAlignment="Right" VerticalAlignment="Bottom" 
                  Width="10" Height="10" Margin="0,5,0,0" IsHitTestVisible="False"/>
        </Grid>
    </Border>
</Window>
