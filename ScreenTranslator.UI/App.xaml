<Application x:Class="ScreenTranslator.UI.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:tb="http://www.hardcodet.net/taskbar"
             Startup="Application_Startup"
             Exit="Application_Exit"
             ShutdownMode="OnExplicitShutdown">
    <Application.Resources>
        <ResourceDictionary>
             <ResourceDictionary.MergedDictionaries>
                <!-- Merge other dictionaries if needed -->
            </ResourceDictionary.MergedDictionaries>
            
            <converters:ValueEqualityConverter x:Key="ValueEqualityConverter" xmlns:converters="clr-namespace:ScreenTranslator.UI.Converters" />
            
            <ContextMenu x:Key="TrayMenu">
                <MenuItem Header="{Binding AppVersion}" IsEnabled="False" FontWeight="Bold"/>
                <Separator />
                <MenuItem Command="{Binding StartSelectionCommand}">
                    <MenuItem.Header>
                        <TextBlock>
                            <Run Text="Capture ("/><Run Text="{Binding HotkeyDisplay, Mode=OneWay}"/><Run Text=")"/>
                        </TextBlock>
                    </MenuItem.Header>
                </MenuItem>
                <Separator />
                <MenuItem Header="Languages">
                    <MenuItem Header="Japanese -> Vietnamese" Command="{Binding SetLanguageCommand}" CommandParameter="ja-vi" IsCheckable="True" IsChecked="{Binding IsJaViSelected, Mode=OneWay}" StaysOpenOnClick="True"/>
                    <MenuItem Header="English -> Vietnamese" Command="{Binding SetLanguageCommand}" CommandParameter="en-vi" IsCheckable="True" IsChecked="{Binding IsEnViSelected, Mode=OneWay}" StaysOpenOnClick="True"/>
                </MenuItem>
                <MenuItem Header="Translator">
                    <MenuItem Header="Standard (Google)" Command="{Binding SetTranslatorCommand}" CommandParameter="Standard" IsCheckable="True" IsChecked="{Binding IsStandardTranslatorSelected, Mode=OneWay}" StaysOpenOnClick="True"/>
                    <MenuItem Header="AI (Gemini)" Command="{Binding SetTranslatorCommand}" CommandParameter="AI" IsCheckable="True" IsChecked="{Binding IsAiTranslatorSelected, Mode=OneWay}" StaysOpenOnClick="True"/>
                </MenuItem>
                <MenuItem Header="Settings">
                    <MenuItem Header="Set Hotkey" Command="{Binding SetHotkeyCommand}" />
                    <MenuItem Header="Set API Key" Command="{Binding SetApiKeyCommand}" />
                    <Separator/>
                    <MenuItem Header="Window Appearance">
                        <MenuItem Header="Opacity">
                             <MenuItem Header="100%" Command="{Binding SetOpacityCommand}" CommandParameter="1.0" IsCheckable="True" IsChecked="{Binding WindowOpacity, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=1.0, Mode=OneWay}" StaysOpenOnClick="True"/>
                            <MenuItem Header="90%" Command="{Binding SetOpacityCommand}" CommandParameter="0.9" IsCheckable="True" IsChecked="{Binding WindowOpacity, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=0.9, Mode=OneWay}" StaysOpenOnClick="True"/>
                            <MenuItem Header="75%" Command="{Binding SetOpacityCommand}" CommandParameter="0.75" IsCheckable="True" IsChecked="{Binding WindowOpacity, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=0.75, Mode=OneWay}" StaysOpenOnClick="True"/>
                            <MenuItem Header="50%" Command="{Binding SetOpacityCommand}" CommandParameter="0.5" IsCheckable="True" IsChecked="{Binding WindowOpacity, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=0.5, Mode=OneWay}" StaysOpenOnClick="True"/>
                        </MenuItem>
                        <MenuItem Header="Font Size">
                            <MenuItem Header="Small (12)" Command="{Binding SetFontSizeCommand}" CommandParameter="12" IsCheckable="True" IsChecked="{Binding WindowFontSize, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=12, Mode=OneWay}" StaysOpenOnClick="True"/>
                            <MenuItem Header="Medium (14)" Command="{Binding SetFontSizeCommand}" CommandParameter="14" IsCheckable="True" IsChecked="{Binding WindowFontSize, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=14, Mode=OneWay}" StaysOpenOnClick="True"/>
                            <MenuItem Header="Large (18)" Command="{Binding SetFontSizeCommand}" CommandParameter="18" IsCheckable="True" IsChecked="{Binding WindowFontSize, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=18, Mode=OneWay}" StaysOpenOnClick="True"/>
                            <MenuItem Header="Extra Large (24)" Command="{Binding SetFontSizeCommand}" CommandParameter="24" IsCheckable="True" IsChecked="{Binding WindowFontSize, Converter={StaticResource ValueEqualityConverter}, ConverterParameter=24, Mode=OneWay}" StaysOpenOnClick="True"/>
                        </MenuItem>
                        <MenuItem Header="Show Source Text" IsCheckable="True" IsChecked="{Binding ShowSourceText, Mode=TwoWay}" StaysOpenOnClick="True"/>
                        <!-- Realtime Translation removed from Tray Menu by user request -->
                    </MenuItem>
                </MenuItem>
                <Separator />
                <MenuItem Header="Exit" Command="{Binding ExitCommand}" />
            </ContextMenu>
            
            <tb:TaskbarIcon x:Key="TrayIcon"
                            ToolTipText="Screen Translator"
                            ContextMenu="{StaticResource TrayMenu}">
            </tb:TaskbarIcon>
        </ResourceDictionary>
    </Application.Resources>
</Application>
